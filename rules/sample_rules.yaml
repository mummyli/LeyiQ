rules:
  - id: "R00001"
    name: "patient_id_required"
    description: "patient_id should not be empty"
    type: "required"
    dataset: "admissions"
    field: "patient_id"
    severity: "ERROR"
    tags: ["stream","batch"]
    owner: "etl-team"
    version: 1
    params:
      sample_limit: 50
    tests:
      - name: "empty patient_id fails"
        input:
          - patient_id: ""
        expect_fail: true

  - id: "R00002"
    name: "age_range"
    description: "The age should be within a reasonable range"
    type: "range"
    dataset: "admissions"
    field: "age"
    severity: "WARN"
    params:
      min: 0
      max: 120

  - id: "R00003"
    name: "age_type_check"
    description: "The field should be an integer"
    type: "datatype"
    dataset: "admissions"
    field: "age"
    severity: "ERROR"
    params:
      expected_type: "int"

  - id: "R00005"
    name: "admission_date_check"
    description: "Admission date must be valid date in format YYYY-MM-DD"
    type: "datatype"
    dataset: "admissions"
    field: "admission_date"
    severity: "ERROR"
    params:
      expected_type: "date"
      format: "%Y-%m-%d"

  - id: "R00006"
    name: "admission_time_check"
    description: "admission time must be valid time in format HH:MM:SS"
    type: "datatype"
    dataset: "admissions"
    field: "admission_time"
    severity: "ERROR"
    params:
      expected_type: "time"

  - id: "R00007"
    name: "ts_datetime_check"
    description: "Event datetime must be valid in format YYYY-MM-DD HH:MM:SS"
    type: "datatype"
    dataset: "admissions"
    field: "ts"
    severity: "ERROR"
    params:
      expected_type: "datetime"
      format: "%Y-%m-%dT%H:%M:%S.%f"

  - id: "R00008"
    name: "guardian_required_if_minor_in_cn"
    description: "If age < 18 AND admission_type != 'EMERGENCY', guardian_name must not be null"
    type: "conditional_mandatory"
    dataset: "admissions"
    field: "guardian_name"
    severity: "ERROR"
    params:
      conditions:
        - field: "age"
          operator: "<"
          value: 18
        - field: "admission_type"
          operator: "!="
          value: "EMERGENCY"
      logic: "AND"

  - id: "R00009"
    name: "admission_date_range"
    type: "datetime_range"
    dataset: "admissions"
    field: "admission_date"
    severity: "ERROR"
    params:
      datatype: "date"
      format: "%Y-%m-%d"
      min: "1900-01-01"
      max: "2025-12-31"

  - id: "R00010"
    name: "admission_time_range"
    type: "datetime_range"
    dataset: "admissions"
    field: "admission_time"
    severity: "ERROR"
    params:
      datatype: "time"
      format: "%H:%M:%S"
      min: "07:00:00"
      max: "18:00:00"

  - id: "R00011"
    name: "ts_time_range"
    type: "datetime_range"
    dataset: "admissions"
    field: "ts"
    severity: "ERROR"
    params:
      datatype: "datetime"
      format: "%Y-%m-%dT%H:%M:%S.%f"
      min: "2020-01-01T00:00:00.000000"
      max: "2030-12-31T23:59:59.999999"
